<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" type="image/png" href="/images/cabin.png"><link href="/styles/main.css" rel="stylesheet"><title>World Wide Web Home of Matthew Phillips</title></head><body><ul class="nav group"><li class="icon-menu menu"></li><li class="nav-link red active"><a href="/" class="name">WWW Home</a></li><li class="nav-link blue"><a href="/about.html">about</a></li><li class="nav-link orange"><a href="/projects.html">projects</a></li><li class="nav-link green"><a href="/archives.html">archives</a></li></ul><div class="content"><div class="post"><div class="post-head group"><a href="/posts/functional-javascript-in-action.html"><h1 class="post-title">Functional JavaScript in action</h1></a><h2 class="post-date">Published&nbsp<abbr title="2013-11-28T00:00:00.000Z" class="timeago"></abbr></h2></div><div class="post-body markdown"><p>Recently came across a <a href="http://redactweb.com/javascript-to-convert-between-states-and-abbreviations/">blog post</a> about a JavaScript function to convert state names to abbreviations (or vice versa) and realized that it&#39;s an excellent topic to present the power that can be had from functional programming in JavaScript.</p>
<p>The premise of the article is that the author needed a function that when given a state name or abbreviation would return the opposite. The author went about it by first finding a PHP function that does the same, then simply converted the code over to JavaScript. While this method surely works for the purpose needed, it also illustrates how powerful functional programming techniques could be used instead which will produce the same result, but also have some reusable code.</p>
<p>First, let&#39;s rewrite the function to get rid of the looping pattern. To do this in a more functional way we can break down what is happening into a few steps. The function is provided two arguments: <code>name</code> and <code>to</code>. Name is the value that we are looking up in our array and to is the key that we want to convert to. Given that, in order to find the value we need to know the name of the key of that value. It&#39;s the opposite of <code>to</code>, right? Using the power of Underscore/Lodash -- I prefer <a href="http://lodash.com/docs">Lo-Dash</a> -- this can be done using the <code>_.without</code> function. Now, keep in mind that for performance it would probably be better to find the <code>from</code> value using a ternary expression, but for the sake of the article we want to do it in a functional way. So that makes our first expression:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">],</span> <span class="nx">to</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</code></pre>
<p>What this does is simply take the array, find the value that matches <code>to</code> and remove it, leaving only one string which is our <code>from</code> key.</p>
<p>Now that we know what our <code>from</code> key is, we need to look up the <code>name</code> in our states array. But before we do that let&#39;s see how the original blog post is doing the lookup:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">states</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">value</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">to</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">abbrev</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()){</span>
      <span class="nx">returnthis</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">to</span> <span class="o">==</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()){</span>
      <span class="nx">returnthis</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">abbrev</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>Simple enough, they are looping over their <code>states</code> array and finding the value that matches what they want to convert. If they are converting to <code>name</code>, then they are comparing against the <code>abbrev</code>, and they are converting to <code>abbrev</code> they are comparing to <code>name</code>. When they find the match they assign it to their <code>returnthis</code> variable and then returning false, which will existing the loop in <code>$.each</code>.</p>
<p>We can do better. Since we&#39;ve already gotten the <code>from</code> key, we can skip the repetitive if/else block that does the same thing. And instead of using an <code>each</code> loop let&#39;s use the power of functional programming to <code>_.find</code> that value.</p>
<p>First, let&#39;s construct a regular expression that we can test against values, to prevent the <code>toLowerCase</code> conversion they are doing.</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">exp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>
</pre></div>
</code></pre>
<p>This simply creates a regular expression that matches for the <code>name</code>, ignoring case. Now let&#39;s find the object that matches the value in our <code>from</code> key:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">states</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">st</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">st</span><span class="p">[</span><span class="nx">from</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>Perfect, this will find the object we are looking for (<code>RegExp.prototype.test</code> returns true on a match) and we only need to return the <code>to</code> key. Full source:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">convertState</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">],</span> <span class="nx">to</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">exp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">states</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">st</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">st</span><span class="p">[</span><span class="nx">from</span><span class="p">]);</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">selected</span><span class="p">[</span><span class="nx">to</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>But wait, we&#39;ve uncovered a pattern here. This is where functional programming becomes most useful. When you write a bit of code, note that there&#39;s a pattern, and abstract out that pattern so that you can reuse the code whenever the pattern is discovered. In our case, what are we really doing? We&#39;re operating on an array of objects, each containing 2 keys. We look up the value from one key and return the other. Simple, right?</p>
<p>So what we can and should do is create a function that does all of this for you automatically. It returns a functional that operates on that set of rules using the array you provide it. First we need to replace this line:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">],</span> <span class="nx">to</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</code></pre>
<p>To get rid of the hard coded string array. Instead we want to pass in our &quot;array of objects&quot; and have the function find the fields. We can do that like so:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">fields</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</code></pre>
<p>And then we simply need to return a function that takes <code>name</code> (for value lookup) and <code>to</code> arguments. With that we&#39;ve created a <strong><em>higher order function</em></strong> that makes it easy any time we have a situation with the same pattern. Full source and examples below.</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">makeSwappable</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">fields</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="nx">fields</span><span class="p">,</span> <span class="nx">to</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">exp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="nx">from</span><span class="p">]);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">selected</span><span class="p">[</span><span class="nx">to</span><span class="p">];</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">convertState</span> <span class="o">=</span> <span class="nx">makeSwappable</span><span class="p">(</span><span class="nx">states</span><span class="p">);</span>

<span class="nx">convertState</span><span class="p">(</span><span class="s1">&#39;Kentucky&#39;</span><span class="p">,</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">);</span> <span class="c1">// -&gt; &#39;KY&#39;</span>
<span class="nx">convertState</span><span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">// -&gt; &#39;California&#39;</span>
</pre></div>
</code></pre>
</div></div><div class="post"><div class="post-head group"><a href="/posts/beware-the-creeper.html"><h1 class="post-title">Beware the Creeper</h1></a><h2 class="post-date">Published&nbsp<abbr title="2013-09-17T00:00:00.000Z" class="timeago"></abbr></h2></div><div class="post-body markdown"><p><em>By Jason Hall</em></p>
<p><em>Art by Cliff Chiang</em></p>
<p>I have an affinity for The Creeper which dates back to Steve Niles&#39; brief run. Niles&#39; <em>30 Days of Night</em> series was one of the books that got me into comics. So given that, and the fabulous cover to the graphic novel, the chances of me not liking this book were close to zero. No need to worry though, my bias cannot be blamed for this one, as this has to be the definitive Creeper story ever told. Hall&#39;s convinced me that Creeper is a character that belongs in 1925 Paris and that will color all interpretations that I read going forward.</p>
<p>It&#39;s interesting that this is the case, because about half way through the book it became apparent to me that Jason Hall really just wanted to write about the surrealism and the bohemian movement in France during the early 20th century. I&#39;m rather glad that he found the excuse because with the few short acts of <strong>Beware the Creeper</strong> he was able to craft together a world that really feels lived in. That he managed to throw in a classic DC villain into the mix without making it feel the slightest bit ridiculous is commendable. In fact I wonder if this book was concepted around The Creeper or if The Creeper was only selected after Hall had decided that he wanted to do a book about French surrealism.</p>
<p>Structurally the book is not breaking any new territory. In the first act we are introduced to the characters, ending in Judith Benoir&#39;s rape and (seemingly) transformation into The Creeper. Act two is the escalation and what happens to Paris as a result of The Creeper coming on to the scene. At first they openly embrace him/her as she/he seems to represent the surrealist rejection of the ordinary. By the end of the second act, however, the feeling is that The Creeper has gone too far (having been accused of a couple of murders) and so we see that despite their embellishments the people of Paris have some, frankly, normal values as well. Act three is where we find out that things are not what they seem; I&#39;ll not spoil that particular reveal but instead just say that the hints are all over the book and not something you&#39;ll have trouble putting together yourself.</p>
<p>I always question trickery of the sort in a non-detective book. The questions I ask is if the twist is necessary and if it detracts from the themes of the book. Examining this I have to wonder what it is that the twist is supposed to reveal. Something about Paris or about the characters? For it&#39;s many strengths, <strong>Beware the Creeper</strong> is not particularly a character piece. Aside from that of the Creeper&#39;s secret identity, the rest are fairly ordinary characters who could have been plucked from any other story written in a similar structure. The characters are not the focal point and that&#39;s why I think it works. The Creeper is not a product of events that occurred as much as he/she is a product of surrealism itself. That someone can go inside is nothing novel; that they go insane and turn into... this, well that can only happen in the setting in which this lives.</p>
<p>Ultimately that&#39;s why this book is so successful. Hall has recreated Paris 1925 in a way that we all feel we are there ourselves. The story is merely an excuse to visit this world for an hour (or so). Here&#39;s hoping Hall allows us to revisit this world some day.</p>
</div></div><div class="pagination group"><a href="/page/2/" class="newer">Newer &#8594;</a><a href="/page/4/" class="older">&#8592; Older</a></div></div><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.2/jquery.min.js" type="text/javascript"></script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.1.0/jquery.timeago.min.js" type="text/javascript"></script><script src="/scripts/main.js" type="text/javascript"></script></body></html>