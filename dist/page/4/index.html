<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" type="image/png" href="/images/cabin.png"><link href="/styles/main.css" rel="stylesheet"><title>World Wide Web Home of Matthew Phillips</title></head><body><ul class="nav group"><li class="icon-menu menu"></li><li class="nav-link red active"><a href="/" class="name">WWW Home</a></li><li class="nav-link blue"><a href="/about.html">about</a></li><li class="nav-link orange"><a href="/projects.html">projects</a></li><li class="nav-link green"><a href="/archives.html">archives</a></li></ul><div class="content"><div class="post"><div class="post-head group"><a href="/posts/building-an-accordion-with-can-component.html"><h1 class="post-title">Building an accordion with can.Component</h1></a><h2 class="post-date">Published&nbsp<abbr title="2013-12-02T00:00:00.000Z" class="timeago"></abbr></h2></div><div class="post-body markdown"><p>I learn best by doing, so in an effort to learn more about <a href="http://canjs.com/guides/Components.html">can.Component</a> I&#39;ve been creating common types of components using the new framework. An <strong>accordion</strong> is one such example and I wanted to write about my experience creating the component. Note that this article doesn&#39;t constitute a best practice, I&#39;ve only been using can.Component for a few weeks now. Nor is the goal here for the least amount of code (My first couple of iterations used less code actually), rather I wanted to write the component as DRY as possible.</p>
<p>I&#39;ve long been a fan of the <a href="http://www.w3.org/TR/components-intro/">Web Components</a> and was excited at the idea that <a href="http://canjs.com/index.html">can</a> could make it possible to write components today. Components are much different than traditional MVC-style programming, in that much more of your code is spent expressing what a component is rather than listening for DOM events and reacting. To that purpose, when I set out to create an accordion control I started with what I wanted it to look like in the end.</p>
<p>An accordion is made up of a list of elements, each with a header and content, that when the header is clicked the content collapses and only the header is shown. So in the end, our html should look something like:</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;accordion&gt;</span>
  <span class="nt">&lt;collapsible&gt;</span>...<span class="nt">&lt;/collapsible&gt;</span>
  <span class="nt">&lt;collapsible&gt;</span>...<span class="nt">&lt;/collapsible&gt;</span>
  <span class="nt">&lt;collapsible&gt;</span>...<span class="nt">&lt;/collapsible&gt;</span>
<span class="nt">&lt;/accordion&gt;</span>
</pre></div>
</code></pre>
<p>Note that we actually have 2 components here. It&#39;s important that the <code>collapsible</code> component operate independently of being hosted inside of an <code>accordion</code>. This leads to DRYer code, a <code>collapsible</code> component is something that can be useful in a lot of places.</p>
<h2><a name="collapsible" class="anchor" href="#collapsible"><span class="header-link"></span></a>Collapsible</h2>
<p>So first to build our <code>collapsible</code> component. Like I said before, a <code>collapsible</code> has a header containing a title, and it has a content section. It should look something like:</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;collapsible</span> <span class="na">class=</span><span class="s">&quot;open&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;header&gt;</span>
    <span class="nt">&lt;h1&gt;</span>This is a title<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/header&gt;</span>
  <span class="nt">&lt;article&gt;</span>This is content.<span class="nt">&lt;/article&gt;</span>
<span class="nt">&lt;/collapsible&gt;</span>
</pre></div>
</code></pre>
<p>Note that the collapsible contains a class called <code>open</code>. This will be used with CSS to control the <code>article</code>&#39;s height. If the collapsible is not open we&#39;ll hide it by setting its height to <code>0px</code> and overflow to <code>none</code>. Now to the code for this component:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="nx">can</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;collapsible&#39;</span><span class="p">,</span>
  <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;&lt;header can-click=&quot;toggle&quot;&gt;&lt;h1&gt;{{item.title}}&lt;/h1&gt;&lt;/header&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;article&gt;{{item.content}}&lt;/article&gt;&#39;</span><span class="p">,</span>
  <span class="nx">scope</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">item</span><span class="o">:</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">Map</span><span class="p">({}),</span>
    <span class="nx">toggle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;item.open&#39;</span><span class="p">,</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;item.open&#39;</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;{item} open&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="nx">newVal</span> <span class="o">?</span> <span class="s1">&#39;addClass&#39;</span> <span class="o">:</span> <span class="s1">&#39;removeClass&#39;</span><span class="p">](</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>It&#39;s pretty straight forward. The <code>can-click=&quot;toggle&quot;</code> attribute tells can that when the header is clicked, call the <code>toggle</code> function, which is part of the component&#39;s scope. The <code>toggle</code> function simple toggle the <code>item</code>&#39;s <code>open</code> flag. Then we have an event that listens for the changes to <code>open</code> and sets the element&#39;s class appropriately. Note that I could have placed the <code>open</code> class as part of the <code>&lt;article&gt;</code> element. The advantage to doing it that way is that it could have been included in the template which would have avoided the entire events section of the code. Ultimately I decided that it was more <em>correct</em> to have the <code>collapsible</code> itself be either open or not. Either approach is valid. The CSS is straight forward, but if you&#39;re a better designer than I you might use transforms or transitions.</p>
<pre><code class="lang-css"><div class="highlight"><pre><span class="nt">collapsible</span> <span class="nt">article</span> <span class="p">{</span>
  <span class="k">overflow</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
  <span class="k">height</span><span class="p">;</span> <span class="m">0px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">collapsible</span><span class="nc">.open</span> <span class="nt">article</span> <span class="p">{</span>
  <span class="k">height</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>You can try this on your own, using this simple component you have a collapsible header/content panel.</p>
<h2><a name="accordion" class="anchor" href="#accordion"><span class="header-link"></span></a>Accordion</h2>
<p>An accordion simple wraps a number of <code>collapsible</code>s and has 1 extra feature: it ensures that only 1 collapsible is open at a time. So in order to create my accordion I really only need a couple of things:</p>
<ol>
<li>A way to listen for when a collapsible&#39;s <code>open</code> property changes.</li>
<li>A way to determine which items need to be set to closed.</li>
</ol>
<p>Below is the code that creates our accordion, take a look first and then I&#39;ll step you through what is happening.</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="nx">can</span><span class="p">.</span><span class="nx">Component</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">tag</span><span class="o">:</span> <span class="s1">&#39;accordion&#39;</span><span class="p">,</span>
  <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;{{#each items}}&lt;collapsible item=&quot;items.{{@index}}&quot;&gt;&#39;</span> <span class="o">+</span>
    <span class="s1">&#39;&lt;/collapsible&gt;{{/each}}&#39;</span><span class="p">,</span>
  <span class="nx">scope</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">items</span><span class="o">:</span> <span class="k">new</span> <span class="nx">can</span><span class="p">.</span><span class="nx">List</span><span class="p">([]).</span>
    <span class="nx">selected</span><span class="o">:</span> <span class="s1">&#39;@&#39;</span><span class="p">,</span>
    <span class="nx">select</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">isOpen</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">===</span> <span class="nx">index</span><span class="p">;</span>
        <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="nx">isOpen</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;inserted&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;selected&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">selected</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="s1">&#39;{items} change&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">what</span><span class="p">,</span> <span class="nx">how</span><span class="p">,</span> <span class="nx">newVal</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="nx">what</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">newVal</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">which</span> <span class="o">=</span> <span class="o">+</span><span class="nx">what</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">what</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">which</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>The first thing you&#39;re likely to notice is that we&#39;re attaching this to the collapsible: <code>item=&quot;items.{{@index}}&quot;</code>. We are doing this because the way you pass data to a child component is through its attributes. The attribute&#39;s name is the name of the property on the component&#39;s scope that we want to set, in this case <code>item</code>. The attribute value is the name of the parent scope&#39;s property that we want to pass in, in this case <code>item.0</code> (or <code>item.1</code>, etc. <code>{{@index}}</code> gets the index inside of our each loop).</p>
<p>Since the <code>collapsible</code> controls its own <code>open</code> state we only need to observe changes that happen to our children items. This is what is happening in the <code>{items} change</code> event. Any time something changes to one of our items we check to see if it is an open event, and if so we run the scope&#39;s <code>select</code> method which takes the index of the item that is selected and marks all others as closed (by changing their <code>close</code> property, which automatically prompts an event in the <code>collapsible</code> component which is what actually removes the class.</p>
<p>And that&#39;s pretty much all there is to an accordion. One other thing you might be unaware of is why the scope has a <code>selected</code> property with a value of <code>@</code>. This means that we want to use the value of the attribute rather than an object it refers to. We use this so that you can pass in the default collapsible to open like so: <code>&lt;accordion selected=&quot;2&quot;&gt;&lt;/accordion&gt;</code> means that the <code>collapsible</code> with an index of 2 will be open and all others closed.</p>
<h2><a name="summary" class="anchor" href="#summary"><span class="header-link"></span></a>Summary</h2>
<p>As you can see, creating reusable components with can.Component is fairly straight forward. It&#39;s just a matter of rethinking how you design a component, to be more declarative. I&#39;m hopeful that designing this way will make it more natural to create smaller, more modular components. Your application itself should be merely a declaration of componenents and bindings of data between them.</p>
<h2><a name="demo" class="anchor" href="#demo"><span class="header-link"></span></a>Demo</h2>
<iframe width="100%" height="300" src="http://jsfiddle.net/a6r3c/6/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>
</div></div><div class="post"><div class="post-head group"><a href="/posts/functional-javascript-in-action.html"><h1 class="post-title">Functional JavaScript in action</h1></a><h2 class="post-date">Published&nbsp<abbr title="2013-11-28T00:00:00.000Z" class="timeago"></abbr></h2></div><div class="post-body markdown"><p>Recently came across a <a href="http://redactweb.com/javascript-to-convert-between-states-and-abbreviations/">blog post</a> about a JavaScript function to convert state names to abbreviations (or vice versa) and realized that it&#39;s an excellent topic to present the power that can be had from functional programming in JavaScript.</p>
<p>The premise of the article is that the author needed a function that when given a state name or abbreviation would return the opposite. The author went about it by first finding a PHP function that does the same, then simply converted the code over to JavaScript. While this method surely works for the purpose needed, it also illustrates how powerful functional programming techniques could be used instead which will produce the same result, but also have some reusable code.</p>
<p>First, let&#39;s rewrite the function to get rid of the looping pattern. To do this in a more functional way we can break down what is happening into a few steps. The function is provided two arguments: <code>name</code> and <code>to</code>. Name is the value that we are looking up in our array and to is the key that we want to convert to. Given that, in order to find the value we need to know the name of the key of that value. It&#39;s the opposite of <code>to</code>, right? Using the power of Underscore/Lodash -- I prefer <a href="http://lodash.com/docs">Lo-Dash</a> -- this can be done using the <code>_.without</code> function. Now, keep in mind that for performance it would probably be better to find the <code>from</code> value using a ternary expression, but for the sake of the article we want to do it in a functional way. So that makes our first expression:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">],</span> <span class="nx">to</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</code></pre>
<p>What this does is simply take the array, find the value that matches <code>to</code> and remove it, leaving only one string which is our <code>from</code> key.</p>
<p>Now that we know what our <code>from</code> key is, we need to look up the <code>name</code> in our states array. But before we do that let&#39;s see how the original blog post is doing the lookup:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">states</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">value</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">to</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">abbrev</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()){</span>
      <span class="nx">returnthis</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">to</span> <span class="o">==</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()){</span>
      <span class="nx">returnthis</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">abbrev</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>Simple enough, they are looping over their <code>states</code> array and finding the value that matches what they want to convert. If they are converting to <code>name</code>, then they are comparing against the <code>abbrev</code>, and they are converting to <code>abbrev</code> they are comparing to <code>name</code>. When they find the match they assign it to their <code>returnthis</code> variable and then returning false, which will existing the loop in <code>$.each</code>.</p>
<p>We can do better. Since we&#39;ve already gotten the <code>from</code> key, we can skip the repetitive if/else block that does the same thing. And instead of using an <code>each</code> loop let&#39;s use the power of functional programming to <code>_.find</code> that value.</p>
<p>First, let&#39;s construct a regular expression that we can test against values, to prevent the <code>toLowerCase</code> conversion they are doing.</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">exp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>
</pre></div>
</code></pre>
<p>This simply creates a regular expression that matches for the <code>name</code>, ignoring case. Now let&#39;s find the object that matches the value in our <code>from</code> key:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">states</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">st</span><span class="p">){</span>
  <span class="k">return</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">st</span><span class="p">[</span><span class="nx">from</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>Perfect, this will find the object we are looking for (<code>RegExp.prototype.test</code> returns true on a match) and we only need to return the <code>to</code> key. Full source:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">convertState</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">],</span> <span class="nx">to</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">exp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">states</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">st</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">st</span><span class="p">[</span><span class="nx">from</span><span class="p">]);</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">selected</span><span class="p">[</span><span class="nx">to</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<p>But wait, we&#39;ve uncovered a pattern here. This is where functional programming becomes most useful. When you write a bit of code, note that there&#39;s a pattern, and abstract out that pattern so that you can reuse the code whenever the pattern is discovered. In our case, what are we really doing? We&#39;re operating on an array of objects, each containing 2 keys. We look up the value from one key and return the other. Simple, right?</p>
<p>So what we can and should do is create a function that does all of this for you automatically. It returns a functional that operates on that set of rules using the array you provide it. First we need to replace this line:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">],</span> <span class="nx">to</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</pre></div>
</code></pre>
<p>To get rid of the hard coded string array. Instead we want to pass in our &quot;array of objects&quot; and have the function find the fields. We can do that like so:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">fields</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</code></pre>
<p>And then we simply need to return a function that takes <code>name</code> (for value lookup) and <code>to</code> arguments. With that we&#39;ve created a <strong><em>higher order function</em></strong> that makes it easy any time we have a situation with the same pattern. Full source and examples below.</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">makeSwappable</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">fields</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="nx">fields</span><span class="p">,</span> <span class="nx">to</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">exp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="nx">from</span><span class="p">]);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">selected</span><span class="p">[</span><span class="nx">to</span><span class="p">];</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">convertState</span> <span class="o">=</span> <span class="nx">makeSwappable</span><span class="p">(</span><span class="nx">states</span><span class="p">);</span>

<span class="nx">convertState</span><span class="p">(</span><span class="s1">&#39;Kentucky&#39;</span><span class="p">,</span> <span class="s1">&#39;abbrev&#39;</span><span class="p">);</span> <span class="c1">// -&gt; &#39;KY&#39;</span>
<span class="nx">convertState</span><span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">// -&gt; &#39;California&#39;</span>
</pre></div>
</code></pre>
</div></div><div class="pagination group"><a href="/page/3/" class="newer">Newer &#8594;</a><a href="/page/5/" class="older">&#8592; Older</a></div></div><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.2/jquery.min.js" type="text/javascript"></script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.1.0/jquery.timeago.min.js" type="text/javascript"></script><script src="/scripts/main.js" type="text/javascript"></script></body></html>