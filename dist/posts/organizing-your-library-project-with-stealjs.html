<!DOCTYPE html>
<html>
<head>
  <base href="..">
    <meta charset="utf-8">
      <title>Organizing your library project with StealJS | Matthew Phillips</title>

    <meta name="author" content="Matthew Phillips">
    <meta name="date" content="2015-03-30">

    <link rel="stylesheet" href="styles//normalize.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Code+Pro:300,600">
    <link rel="stylesheet" href="styles/screen.css">
    <link rel="stylesheet" href="styles/github.css">
</head>
<body>
  <section class="content">
    <header>
      <h1 id="gistid"><a href="https://gist.github.com/b9e52cf96263e101eec6">gist #b9e52cf96263e101eec6</a></h1>
      <h2 id="description" class="instapaper_title entry-title">
        <span id="prompt"><span class="host">matthew@local</span><span>:</span><span class="tilde">~</span><span class="dollar">$<?span></span>
        <span> echo 'Organizing your library project with StealJS'</span>
      </h2>
    </header>

    <div id="gistbody" class="instapaper_body entry-content">
      <article>
        <p>With <a href="http://stealjs.com/">StealJS</a> you can easily set up an open-source library that fits with the way you like to organize your code. A common directory structure might look like this:</p>
<pre><code>-<span class="ruby"> src
</span>  -<span class="ruby"> main.js
</span>  -<span class="ruby"> dep.js
</span>-<span class="ruby"> test
</span>  -<span class="ruby"> test.html
</span>  -<span class="ruby"> test.js
</span>package.json
Gruntfile.js
</code></pre><p>In order to keep a shallow folder structure we&#39;ve divided the library&#39;s source code in <code>src</code> and its tests in <code>test</code>. The root directory only contains our <code>package.json</code> and a <code>Gruntfile.js</code> for builds.</p>
<p>With this structure you might try to install your module with NPM:</p>
<pre><code class="hljs shell">npm <span class="hljs-operator"><span class="hljs-keyword">install</span> my-<span class="hljs-keyword">module</span> <span class="hljs-comment">--save</span></span>
</code></pre>
<p>And then load it in your project:</p>
<pre><code class="hljs js"><span class="hljs-keyword">import</span> myModule <span class="hljs-keyword">from</span> <span class="hljs-string">"my-module"</span>;
</code></pre>
<p>However this will fail because your <code>main</code> is not pointing to right place. Imagine your <code>main.js</code> look like:</p>
<pre><code class="hljs js"><span class="hljs-keyword">import</span> dep <span class="hljs-keyword">from</span> <span class="hljs-string">"my-module/dep"</span>;
</code></pre>
<p>Steal will look for <code>dep.js</code> in the project&#39;s root folder. To set an alternative root, correctly called the lib folder, set it in the <code>package.json</code>:</p>
<pre><code class="hljs json">{
  "<span class="hljs-attribute">name</span>": <span class="hljs-value"><span class="hljs-string">"my-module"</span></span>,
  "<span class="hljs-attribute">main</span>": <span class="hljs-value"><span class="hljs-string">"dist/cjs/main.js"</span></span>,
  "<span class="hljs-attribute">system</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">main</span>": <span class="hljs-value"><span class="hljs-string">"main"</span></span>,
    "<span class="hljs-attribute">directories</span>": <span class="hljs-value">{
      "<span class="hljs-attribute">lib</span>": <span class="hljs-value"><span class="hljs-string">"src"</span>
    </span>}
  </span>}
</span>}
</code></pre>
<p>This tells Steal that your library&#39;s code is nested under the <code>src</code> folder. This makes it easy to refer to your module by name in its internal code. With your test do the same thing:</p>
<pre><code class="hljs js"><span class="hljs-keyword">import</span> myModuleDep <span class="hljs-keyword">from</span> <span class="hljs-string">"my-module/dep"</span>;
</code></pre>
<p>Will correctly load <code>src/dep.js</code> if that&#39;s the module you want to test.</p>
<h2 id="building">Building</h2>
<p>If you&#39;re only target Steal you can go ahead and publish your module on NPM. But if you want to reach users of other module loaders you should set up a build script. <a href="http://stealjs.com/docs/steal-tools.html">steal-tools</a> makes this easy. For example if using Grunt:</p>
<pre><code class="hljs js">grunt.initConfig({
  <span class="hljs-string">"steal-export"</span>: {
    dist: {
      <span class="hljs-keyword">system</span>: {
        config: <span class="hljs-string">"package.json!npm"</span>
      },
      outputs: {
        <span class="hljs-string">"+cjs"</span>: {},
        <span class="hljs-string">"+amd"</span>: {},
        <span class="hljs-string">"global-js"</span>: {]
      }
    }
  }
});
</code></pre>
<p>Then by simply running <code>grunt steal-export</code> will produce <code>dist/cjs</code>, <code>dist/amd</code>, and <code>dist/global</code> folders containing code that will run in RequireJS, Browserify, and as a browser global. Read <a href="http://stealjs.com/docs/StealJS.project-exporting.html">the full guide</a> on setting up an export for your project for more.</p>
<p>See <a href="https://github.com/bitovi-components/bit-tabs">bit-tabs</a> for a full example of this directory structure in action.</p>


      </article>
    </div>
    <footer style="display: block">
      <p>Matthew Phillips</p>
    </footer>
  </section>
</body>
</html>
