<!DOCTYPE html>
<html>
<head>
  <base href="..">
    <meta charset="utf-8">
      <title>Responsive Computes | Matthew Phillips</title>

    <meta name="author" content="Matthew Phillips">
    <meta name="date" content="2014-05-10">

    <link rel="stylesheet" href="styles//normalize.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Code+Pro:300,600">
    <link rel="stylesheet" href="styles/screen.css">
    <link rel="stylesheet" href="styles/github.css">
</head>
<body>
  <section class="content">
    <header>
      <h1 id="gistid"><a href="https://gist.github.com/d804a642a5385907dc1c">gist #d804a642a5385907dc1c</a></h1>
      <h2 id="description" class="instapaper_title entry-title">Responsive Computes</h2>
    </header>

    <div id="gistbody" class="instapaper_body entry-content">
      <article>
        <p>Recently I was working on a template and ran into issues trying to make it responsive purely using CSS media queries. The problem is that the mark-up of the mobile view and that of the desktop were just too different. In fact, the <em>functionality</em> of the two views were a bit different as well.</p>
<p>At this point you might give up and just write up two separate templates and use media queries to hide one of them. Bootstrap even <a href="http://getbootstrap.com/css/#responsive-utilities-classes">has classes</a> for just such a case.</p>
<p>Luckily, however, there is the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.matchMedia">matchMedia</a> API that brings the power of media queries to JavaScript. There&#39;s fairly broad <a href="http://caniuse.com/#feat=matchmedia">browse support</a> and even <a href="https://github.com/weblinc/media-match/blob/master/media.match.js">a polyfill</a> if you want support in older IE browsers. matchMedia allows you to use the same type of media queries in JavaScript that you can use in CSS, for example:</p>
<pre><code class="hljs javascript"><span class="hljs-reserved">var</span> mql = matchMedia(<span class="hljs-string">'only screen and (max-width: 768px)'</span>);
mql.matches === <span class="hljs-literal">true</span>; <span class="hljs-regexp">//</span> <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> the screen <span class="hljs-keyword">is</span> &lt;= <span class="hljs-number">768</span>px
</code></pre>
<p>Additionally matchMedia queries include an <code>addListener</code> function that takes a callback that will be called when the media query&#39;s status changes; meaning you can resize the browser and the media query will respond when the screen becomes less than 768px (for example).</p>
<h2 id="live-bound-responsive-templates">Live-bound responsive templates</h2>
<p>If you use CanJS you&#39;re familiar with can.computes, but you might not be familiar with the <a href="http://canjs.com/docs/can.compute.html#sig_can_compute_initialValue__settings__">2nd signature</a> which allows you to create a compute from any type of event emitting object. This means we can easily turn our matchMedia query into a compute that can be used in templates:</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> mql = matchMedia(<span class="hljs-string">'only screen and (max-width: 768px)'</span>);

<span class="hljs-keyword">var</span> mobile = can.compute(mql.matches, {
  <span class="hljs-keyword">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">return</span> mql.matches;
  },
  <span class="hljs-keyword">set</span>: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-comment">// Do nothing for this one</span>
  },
  on: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(updated)</span></span>{
    mql.addListener(updated);
  },
  off: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(updated)</span></span>{
    mql.removeListener(updated);
  }
});
</code></pre>
<p>The compute&#39;s <code>settings</code> object describes how to bind the compute to the media query and respond to changes. Now your templates can be responsive in a much more powerful way than what CSS allows:</p>
<pre><code class="hljs handlebars"><span class="xml"></span><span class="hljs-expression">{{<span class="hljs-begin-block">#<span class="hljs-keyword">if</span> mobile</span>}}</span><span class="xml">
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>Hi there phone! Mobile navigation goes here.<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</span><span class="hljs-expression">{{<span class="hljs-variable"><span class="hljs-keyword">else</span></span>}}</span><span class="xml">
  <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>Totally different desktop experience!<span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
</span><span class="hljs-expression">{{<span class="hljs-end-block">/<span class="hljs-keyword">if</span></span>}}</span><span class="xml"></span>
</code></pre>
<p>The broader lesson here is that <a href="http://canjs.com/docs/can.compute.html">can.computes</a> are crazy powerful. If you&#39;re only using them to respond to changes in your business logic you&#39;re not unlocking their full potential. The browser provides many APIs, like matchMedia, that can be bound to. Check out the <a href="http://bitovi.com/blog/2013/04/weekly-widget-compute-slider.html">video slider</a> and be inspired.</p>


      </article>
    </div>
    <footer style="display: block">
      <p>Matthew Phillips</p>
    </footer>
  </section>
</body>
</html>
