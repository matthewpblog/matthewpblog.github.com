<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" type="image/png" href="/images/cabin.png"><link href="/styles/main.css" rel="stylesheet"><title>Responsive Computes</title></head><body><ul class="nav group"><li class="icon-menu menu"></li><li class="nav-link red"><a href="/" class="name">WWW Home</a></li><li class="nav-link blue"><a href="/about.html">about</a></li><li class="nav-link orange"><a href="/projects.html">projects</a></li><li class="nav-link green"><a href="/archives.html">archives</a></li></ul><div class="content"><div class="post"><div class="post-head group"><a href="/posts/responsive-computes.html"><h1 class="post-title">Responsive Computes</h1></a><h2 class="post-date">Published&nbsp<abbr title="2014-05-11T00:00:00.000Z" class="timeago"></abbr></h2></div><div class="post-body markdown"><p>Recently I was working on a template and ran into issues trying to make it responsive purely using CSS media queries. The problem is that the mark-up of the mobile view and that of the desktop were just too different. In fact, the <em>functionality</em> of the two views were a bit different as well.</p>
<p>At this point you might give up and just write up two separate templates and use media queries to hide one of them. Bootstrap even <a href="http://getbootstrap.com/css/#responsive-utilities-classes">has classes</a> for just such a case.</p>
<p>Luckily, however, there is the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.matchMedia">matchMedia</a> API that brings the power of media queries to JavaScript. There&#39;s fairly broad <a href="http://caniuse.com/#feat=matchmedia">browse support</a> and even <a href="https://github.com/weblinc/media-match/blob/master/media.match.js">a polyfill</a> if you want support in older IE browsers. matchMedia allows you to use the same type of media queries in JavaScript that you can use in CSS, for example:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mql</span> <span class="o">=</span> <span class="nx">matchMedia</span><span class="p">(</span><span class="s1">&#39;only screen and (max-width: 768px)&#39;</span><span class="p">);</span>
<span class="nx">mql</span><span class="p">.</span><span class="nx">matches</span> <span class="o">===</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// true if the screen is &lt;= 768px</span>
</pre></div>
</code></pre>
<p>Additionally matchMedia queries include an <code>addListener</code> function that takes a callback that will be called when the media query&#39;s status changes; meaning you can resize the browser and the media query will respond when the screen becomes less than 768px (for example).</p>
<h2><a name="live-bound-responsive-templates" class="anchor" href="#live-bound-responsive-templates"><span class="header-link"></span></a>Live-bound responsive templates</h2>
<p>If you use CanJS you&#39;re familiar with can.computes, but you might not be familiar with the <a href="http://canjs.com/docs/can.compute.html#sig_can_compute_initialValue__settings__">2nd signature</a> which allows you to create a compute from any type of event emitting object. This means we can easily turn our matchMedia query into a compute that can be used in templates:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mql</span> <span class="o">=</span> <span class="nx">matchMedia</span><span class="p">(</span><span class="s1">&#39;only screen and (max-width: 768px)&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">mobile</span> <span class="o">=</span> <span class="nx">can</span><span class="p">.</span><span class="nx">compute</span><span class="p">(</span><span class="nx">mql</span><span class="p">.</span><span class="nx">matches</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="nx">mql</span><span class="p">.</span><span class="nx">matches</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// Do nothing for this one</span>
  <span class="p">},</span>
  <span class="nx">on</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">updated</span><span class="p">){</span>
    <span class="nx">mql</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">updated</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">off</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">updated</span><span class="p">){</span>
    <span class="nx">mql</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">updated</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</code></pre>
<p>The compute&#39;s <code>settings</code> object describes how to bind the compute to the media query and respond to changes. Now your templates can be responsive in a much more powerful way than what CSS allows:</p>
<pre><code class="lang-html"><div class="highlight"><pre>{{#if mobile}}
  <span class="nt">&lt;div&gt;</span>Hi there phone! Mobile navigation goes here.<span class="nt">&lt;/div&gt;</span>
{{else}}
  <span class="nt">&lt;div&gt;</span>Totally different desktop experience!<span class="nt">&lt;/div&gt;</span>
{{/if}}
</pre></div>
</code></pre>
<p>The broader lesson here is that <a href="http://canjs.com/docs/can.compute.html">can.computes</a> are crazy powerful. If you&#39;re only using them to respond to changes in your business logic you&#39;re not unlocking their full potential. The browser provides many APIs, like matchMedia, that can be bound to. Check out the <a href="http://bitovi.com/blog/2013/04/weekly-widget-compute-slider.html">video slider</a> and be inspired.</p>
</div></div></div><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.2/jquery.min.js" type="text/javascript"></script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.1.0/jquery.timeago.min.js" type="text/javascript"></script><script src="/scripts/main.js" type="text/javascript"></script></body></html>